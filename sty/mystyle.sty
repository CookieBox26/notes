% 余白を詰めてページ番号を下げる
\setpagelayout*{top=18truemm,bottom=21truemm,left=18truemm,right=18truemm}
\addtolength{\footskip}{8mm}

% 数式フォント用
\usepackage[mathrm=sym]{unicode-math}
\usepackage{amsmath}

% 色名の読み込みと独自色定義
\usepackage[svgnames]{xcolor}
\definecolor{PaleIris}{RGB}{229,227,246}
\definecolor{PaleGold}{RGB}{255,247,204}
\definecolor{PaleIris2}{RGB}{187,181,229}
\definecolor{PaleGold2}{RGB}{250,230,115}
\definecolor{DarkGray}{RGB}{69,69,69}
\definecolor{DarkCyan}{RGB}{0,123,123}
\definecolor{SlateGray2}{RGB}{91,104,117}

% フォント定義 (日本語が大きくみえるため日本語は小さめにスケール)
% \usepackage{fontspec}  % already loaded by unicode-math
\setmainfont[  % 英数字本文
    BoldFont={[MPLUSRounded1c-Medium.ttf]},
]{[MPLUSRounded1c-Regular.ttf]}
\setsansfont[Color=DarkGray]{[MPLUSRounded1c-Medium.ttf]}  % 英数字見出し
\setmonofont[Scale=1.05]{[RictyDiminished-Regular.ttf]}  % 等幅
\setmathfont[Scale=1.05, Color=DarkGray]{Latin Modern Math}  % 数式
\setCJKmainfont[  % 日本語本文
    Scale=0.95,
    BoldFont={[MPLUSRounded1c-Medium.ttf]},
]{[MPLUSRounded1c-Regular.ttf]}
\setCJKsansfont[Scale=0.95, Color=DarkGray]{[MPLUSRounded1c-Medium.ttf]}  % 日本語見出し
\setCJKmonofont[Scale=0.95]{[MPLUSRounded1c-Regular.ttf]}  % 日本語等幅

% 行間をやや詰める
\usepackage{leading}
\leading{14.5pt}

% カラーボックス
\usepackage[most,listings]{tcolorbox}
\tcbuselibrary{breakable}

% 独自のセリフ枠の定義
\newtcolorbox{SERIFU}[2][]{
    enhanced,  % タイトルボックスの表示に必要
    breakable,  % ページをまたぐのに必要
    % セリフの文字色をグレーに変更する
    fontupper=\addfontfeatures{Color=DarkGray}\
    \addCJKfontfeatures{Color=DarkGray}\color{DarkGray},
    arc=7pt,  % 角の丸みの半径
    top=9pt, right=9pt, left=14pt, bottom=9pt,  % パディング
    boxrule=0pt, frame hidden,  % フレーム隠蔽
    grow to left by=-24pt,  % キャラクター画像を表示するため左にマージン
    % タイトルボックスとしてキャラクター画像を表示
    title={\hspace{6pt}},
    attach boxed title to top left={xshift=-28pt, yshift=-38pt},
    boxed title style={
        enhanced,
        arc=19pt,
        top=17pt, right=13pt, left=14pt, bottom=16pt,
        boxrule=0pt, frame hidden,
        underlay={
            \begin{tcbclipinterior}
            \includegraphics[width=41pt]{#2}
            \end{tcbclipinterior}
        },
    },
    #1
}

% 独自の命題枠の定義
\newtcolorbox{PROP}[2][]{
    enhanced,
    top=10pt,
    right=10pt,
    left=10pt,
    bottom=10pt,
    colbacktitle=White,
    colback=White,
    borderline={{1pt}{0pt}{DarkGray,solid}},
    colframe=White,
    boxrule=1pt,
    arc=6pt,
    breakable,
    attach boxed title to top left={xshift=12pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={skin=enhancedfirst jigsaw, boxrule=0pt, frame hidden, left=2pt, right=2pt},
    title=#2,
    #1
}

\newtcolorbox{PROP2}[2][]{
    enhanced,
    top=10pt,
    right=10pt,
    left=10pt,
    bottom=10pt,
    colbacktitle=White,
    colback=White,
    borderline={{1pt}{0pt}{DarkGray,dashed}},
    colframe=White,
    boxrule=1pt,
    arc=6pt,
    breakable,
    attach boxed title to top left={xshift=10pt, yshift=-\tcboxedtitleheight/2},
    boxed title style={skin=enhancedfirst jigsaw, boxrule=0pt, frame hidden, left=2pt, right=2pt},
    title=#2,
    #1
}

% 独自のコード枠の定義
\newtcolorbox{CODE}[1][]{
    enhanced,
    breakable,  % ページをまたぐのに必要
    arc=2pt,
    colframe=DarkGray,
    boxrule=1pt,
    top=1pt, right=6pt, left=6pt, bottom=1pt,  % パディング
    #1
}

% 奥付
\newtcolorbox{OKUDUKE}[1][]{
    enhanced,
    sharp corners,
    colbacktitle=White,
    colback=White,
    colframe=DarkGray,
    toprule=1.25pt,
    bottomrule=1.25pt,
    rightrule=0pt,
    leftrule=0pt,
    top=4pt, right=6pt, left=6pt, bottom=2pt,  % パディング
    grow to left by=-10pt,
    grow to right by=-10pt,
    attach boxed title to top left={yshift=3pt},
    boxed title style={skin=enhancedfirst jigsaw, boxrule=0pt, frame hidden},
    #1
}

\usepackage[colorlinks=true]{hyperref}  % ハイパーリンク
\hypersetup{urlcolor=PaleVioletRed}
\usepackage{setspace}  % 目次の行間を詰める用

\renewcommand{\footnoterule}{%
  \kern -5pt
  \color{DarkGray}
  \hrule width \textwidth height 0.5pt
  \kern 5pt
}
